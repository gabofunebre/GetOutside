<!DOCTYPE html>
<html lang="es">
<head>
  <!-- ========== Metadatos y Título ========== -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registrar Venta</title>

  <!-- ========== CSS de Bootstrap y Estilos Personalizados ========== -->
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <!-- ========================================================================
       SPINNER OVERLAY (Oculto por defecto, se muestra al enviar el formulario)
       ======================================================================== -->
  <div id="overlay">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando…</span>
    </div>
  </div>

  <!-- ========================================================================
       Contenedor Principal
       ======================================================================== -->
  <div class="container mt-5">

    <!-- ========== Encabezado ========== -->
    <h1 class="mb-4">Registrar Venta</h1>

    <!-- ========== Placeholder de Alertas ========== -->
    <div id="alert-placeholder"></div>

    <!-- ====================================================================
         Sección: Productos
         ==================================================================== -->
    <div class="card mb-4">
      <div class="card-body">
        <h4 class="card-title">Productos</h4>
        <div id="productos-container"></div>
        <button class="btn btn-secondary mt-3" id="add-item">
          Añadir producto
        </button>
      </div>
    </div>

    <!-- ====================================================================
         Sección: Pago y Totales
         ==================================================================== -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row gy-4">

          <!-- ========== Sub-sección: Pago y Descuentos ========== -->
          <div class="col-lg-8">
            <h4 class="card-title">Pago</h4>
            <div id="pagos-container"></div>
            <div id="descuentos-container"></div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-secondary w-100" style="max-width: 180px;" id="add-payment">
                Añadir Medio
              </button>
              <button class="btn btn-secondary w-100" style="max-width: 180px;" id="add-discount">
                Añadir Descuento
              </button>
            </div>
          </div>

          <!-- ========== Sub-sección: Resumen de Totales ========== -->
          <div class="col-lg-4">
            <div class="p-3 border rounded bg-light h-100">
              <h5>Venta</h5>
              <p id="total-venta" class="fs-4">0.00</p>
              <h5>Pagado</h5>
              <p id="total-pago" class="fs-4">0.00</p>
            </div>
          </div>

        </div>
      </div>
    </div>

    <!-- ====================================================================
         Botones Finales (Acciones principales) 
         ==================================================================== -->
    <div class="final-buttons">
      <button class="btn btn-primary" id="submit-sale">
        Registrar Venta
      </button>
      <a href="/" class="text-muted">
        &larr; Volver al Dashboard
      </a>
    </div>

  </div>

  <!-- ========================================================================
       Contenedor para Datos Iniciales (JSON injectado)
       ======================================================================== -->
  <div id="data-holder"
       data-productos='{{ productos | tojson | safe }}'
       data-medios='{{ medios | tojson | safe }}'>
  </div>

  <!-- ========================================================================
       Scripts
       ======================================================================== -->
  <!-- Datos globales para JS -->
  <script>
    const holder = document.getElementById("data-holder");
    window.productosData = JSON.parse(holder.dataset.productos);
    window.mediosData   = JSON.parse(holder.dataset.medios);
  </script>

  <!-- Entry point como Módulo ES -->
  <script type="module" src="/static/js/sales_form/main.js" defer></script>

  <!-- JS de Bootstrap -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous" defer></script>

</body>
</html>
