<!-- app/templates/sales_form.html -->
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registrar Venta</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet" crossorigin="anonymous"
  >
  <link rel="stylesheet" href="/static/css/style.css">
  <style>
    /* Inputs y selects llenan su celda */
    #items-table input,
    #items-table select {
      width: 100%;
    }

    /* Responsive para móvil */
    @media (max-width: 576px) {
      /* Ocultamos cabecera */
      #items-table thead {
        display: none;
      }
      /* Convertimos filas/celdas en bloques */
      #items-table,
      #items-table tbody,
      #items-table tr,
      #items-table td {
        display: block;
        width: 100%;
      }
      /* Espaciado entre productos */
      #items-table tr {
        margin-bottom: 1rem;
        border: 1px solid #dee2e6;
        border-radius: .25rem;
        padding: .5rem;
      }
      /* Cada celda se convierte en una línea flex */
      #items-table td {
        display: flex;
        justify-content: space-between;
        padding: .25rem 0;
      }
      /* Primera celda (producto) ocupa toda la primera línea */
      #items-table td:nth-child(1) {
        font-weight: bold;
        padding-bottom: .5rem;
      }
      /* Resto de celdas muestran etiqueta con ::before */
      #items-table td:nth-child(2)::before {
        content: "Cantidad: ";
        font-weight: bold;
      }
      #items-table td:nth-child(3)::before {
        content: "Precio Unit.: ";
        font-weight: bold;
      }
      #items-table td:nth-child(4)::before {
        content: "Subtotal: ";
        font-weight: bold;
      }
      /* Quinta columna (botón) alineado a la derecha */
      #items-table td:nth-child(5) {
        justify-content: flex-end;
      }
    }
  </style>
</head>
<body>
  <div class="container mt-5">
    <h1 class="mb-4">Registrar Venta</h1>
    <div id="alert-placeholder"></div>

    <!-- Sección Productos -->
    <div class="card mb-4">
      <div class="card-body">
        <h4 class="card-title">Productos</h4>
        <table
          class="table"
          id="items-table"
          style="table-layout: fixed;"
        >
          <colgroup>
            <col style="width: 60%;">
            <col style="width: 12%;">
            <col style="width: 12%;">
            <col style="width: 12%;">
            <col style="width: 4%;">
          </colgroup>
          <thead>
            <tr>
              <th>Producto</th>
              <th>Cantidad</th>
              <th>Precio Unit.</th>
              <th>Subtotal</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <button class="btn btn-secondary" id="add-item">+ Añadir producto</button>
      </div>
    </div>

    <!-- Sección Medios de Pago + Totales -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row gy-4">
          <!-- Medios de Pago -->
          <div class="col-lg-8">
            <h4 class="card-title">Medios de Pago</h4>
            <table
              class="table"
              id="payments-table"
              style="table-layout: fixed;"
            >
              <colgroup>
                <col style="width: 70%;">
                <col style="width: 25%;">
                <col style="width: 5%;">
              </colgroup>
              <thead>
                <tr>
                  <th>Medio</th>
                  <th>Monto</th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <button class="btn btn-secondary" id="add-payment">+ Añadir pago</button>
          </div>
          <!-- Resumen Totales -->
          <div class="col-lg-4">
            <div class="p-3 border rounded bg-light h-100">
              <h5>Total Venta</h5>
              <p id="total-venta" class="fs-4">0.00</p>
              <h5>Total Pagado</h5>
              <p id="total-pago" class="fs-4">0.00</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Botones finales -->
    <div class="d-flex gap-2 mb-5">
      <button class="btn btn-primary flex-shrink-0" id="submit-sale">
        Registrar Venta
      </button>
      <a href="/" class="btn btn-secondary flex-shrink-0">
        &larr; Volver al Dashboard
      </a>
    </div>
  </div>

  <!-- Contenedor de datos JSON inyectados -->
  <div id="data-holder"
       data-productos='{{ productos | tojson | safe }}'
       data-medios='{{ medios    | tojson | safe }}'>
  </div>

  <!-- Scripts -->
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"
    defer
  ></script>
  <script>
    const holder = document.getElementById("data-holder");
    window.productosData = JSON.parse(holder.dataset.productos);
    window.mediosData    = JSON.parse(holder.dataset.medios);
  </script>
  <script src="/static/js/sales_form.js" defer></script>
</body>
</html>
