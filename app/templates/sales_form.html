<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registrar Venta</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <div class="container mt-5">
    <h1 class="mb-4">Registrar Venta</h1>
    <div id="alert-placeholder"></div>

    <!-- Sección Productos -->
    <div class="card mb-4">
      <div class="card-body">
        <h4 class="card-title">Productos</h4>
        <div id="productos-container"></div>
        <button class="btn btn-secondary mt-3" id="add-item">+ Añadir producto</button>
      </div>
    </div>

    <!-- Sección Pago + Totales -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row gy-4">
          <!-- Pago y Descuentos -->
          <div class="col-lg-8">
            <h4 class="card-title">Pago</h4>
            <div id="pagos-container"></div>
            <div id="descuentos-container"></div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-secondary w-100" style="max-width: 180px;" id="add-payment">Añadir Medio</button>
              <button class="btn btn-secondary w-100" style="max-width: 180px;" id="add-discount">Añadir Descuento</button>
            </div>
          </div>

          <!-- Resumen Totales -->
          <div class="col-lg-4">
            <div class="p-3 border rounded bg-light h-100">
              <h5>Venta</h5>
              <p id="total-venta" class="fs-4">0.00</p>
              <h5>Pagado</h5>
              <p id="total-pago" class="fs-4">0.00</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Botones finales -->
    <div class="final-buttons">
      <button class="btn btn-primary" id="submit-sale">
        Registrar Venta
      </button>
      <a href="/" class="text-muted">
        &larr; Volver al Dashboard
      </a>
    </div>
  </div>

  <!-- Contenedor de datos JSON inyectados -->
  <div id="data-holder"
       data-productos='{{ productos | tojson | safe }}'
       data-medios='{{ medios | tojson | safe }}'>
  </div>

  <!-- Scripts -->
  <script>
    const holder = document.getElementById("data-holder");
    window.productosData = JSON.parse(holder.dataset.productos);
    window.mediosData = JSON.parse(holder.dataset.medios);
  </script>
  <script src="/static/js/sales_form.js" defer></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous" defer></script>
</body>
</html>
