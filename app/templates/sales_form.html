<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Registrar Venta</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
  <div class="container mt-5">
    <h1 class="mb-4">Registrar Venta</h1>
    <div id="alert-placeholder"></div>

    <!-- Secci칩n Productos -->
    <div class="card mb-4">
      <div class="card-body">
        <h4 class="card-title">Productos</h4>
        <table class="table" id="items-table" style="table-layout: fixed;">
          <colgroup>
            <col style="width: 60%;">
            <col style="width: 12%;">
            <col style="width: 12%;">
            <col style="width: 12%;">
            <col style="width: 4%;">
          </colgroup>
          <thead>
            <tr>
              <th>Producto</th>
              <th>Cant.</th>
              <th>Precio</th>
              <th>SubT.</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <button class="btn btn-secondary" id="add-item">+ A침adir producto</button>
      </div>
    </div>

    <!-- Secci칩n Pago + Totales -->
    <div class="card mb-4">
      <div class="card-body">
        <div class="row gy-4">
          <!-- Pago -->
          <div class="col-lg-8">
            <h4 class="card-title">Pago</h4>
            <table class="table" id="payments-table" style="table-layout: fixed;">
              <colgroup>
                <col style="width: 70%;">
                <col style="width: 25%;">
                <col style="width: 5%;">
              </colgroup>
              <thead>
                <tr>
                  <th>Medio</th>
                  <th>Monto</th>
                  <th></th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
            <button class="btn btn-secondary" id="add-payment">+ A침adir Medio</button>
          </div>

          <!-- Resumen Totales -->
          <div class="col-lg-4">
            <div class="p-3 border rounded bg-light h-100">
              <h5>Venta</h5>
              <p id="total-venta" class="fs-4">0.00</p>
              <h5>Pagado</h5>
              <p id="total-pago" class="fs-4">0.00</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Botones finales -->
    <div class="d-flex gap-2 mb-5">
      <button class="btn btn-primary flex-shrink-0" id="submit-sale">
        Registrar Venta
      </button>
      <a href="/" class="text-muted d-flex align-items-center">
        &larr; Volver al Dashboard
      </a>
    </div>
  </div>

  <!-- Contenedor de datos JSON inyectados -->
  <div id="data-holder"
       data-productos='{{ productos | tojson | safe }}'
       data-medios='{{ medios | tojson | safe }}'>
  </div>

  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" crossorigin="anonymous" defer></script>
  <script>
    const holder = document.getElementById("data-holder");
    window.productosData = JSON.parse(holder.dataset.productos);
    window.mediosData = JSON.parse(holder.dataset.medios);
  </script>
  <script src="/static/js/sales_form.js" defer></script>
</body>
</html>
